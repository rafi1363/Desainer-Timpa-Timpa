---
import { getImage } from "astro:assets";

// Perintah ini secara otomatis membaca semua gambar dari folder /src/assets/galeri
const semuaGambar = import.meta.glob(
  "/src/assets/galeri/**/*.{png,jpg,jpeg,webp}"
);

const dataGaleri = [];

for (const path in semuaGambar) {
  const modulGambar = await semuaGambar[path]();
  const namaFile = path.split("/").pop();
  const namaArtis = namaFile.split(".").slice(0, -1).join(".");

  // Astro memproses setiap gambar dan memberinya URL unik
  const gambarOptimized = await getImage({
    src: modulGambar.default,
    width: 600,
    format: "webp",
    quality: 80,
  });

  dataGaleri.push({
    artis: `@${namaArtis}`,
    gambar: gambarOptimized,
  });
}
---

<section id="galeri" class="gallery">
  <h3 class="section-title">Karya</h3>

  <div class="gallery-filters">
    {/* ... Tombol filter Anda ... */}
  </div>

  <div class="gallery-grid">
    {
      dataGaleri.map((item) => (
        <div class="gallery-item">
          <img
            src={item.gambar.src}
            width={item.gambar.attributes.width}
            height={item.gambar.attributes.height}
            alt={`Poster Design by ${item.artis}`}
            loading="lazy"
          />
          <div class="gallery-overlay">
            <h4>Poster</h4>
            <p>by {item.artis}</p>
          </div>
        </div>
      ))
    }
  </div>
</section>

<div id="lightbox" class="lightbox">
  <span class="close-button">&times;</span>
  <img class="lightbox-content" id="lightbox-img" />
</div>

<script is:inline>
  document.addEventListener("DOMContentLoaded", function () {
    // Logika untuk Lightbox
    const galleryItems = document.querySelectorAll(".gallery-item");
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightbox-img");
    const closeBtn = lightbox ? lightbox.querySelector(".close-button") : null;

    // Pastikan semua elemen yang dibutuhkan ada di halaman
    if (lightbox && galleryItems.length > 0 && closeBtn) {
      galleryItems.forEach((item) => {
        item.addEventListener("click", () => {
          const imgSrc = item.querySelector("img").src;
          lightboxImg.src = imgSrc;
          lightbox.classList.add("active");
        });
      });

      const closeLightbox = () => lightbox.classList.remove("active");

      closeBtn.addEventListener("click", closeLightbox);

      lightbox.addEventListener("click", (e) => {
        if (e.target === lightbox) {
          closeLightbox();
        }
      });
    }
  });
</script>
