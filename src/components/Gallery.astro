---
import { getImage } from "astro:assets";
import "swiper/css";
import "swiper/css/navigation";
import "swiper/css/pagination";

// Perintah ini secara otomatis membaca semua gambar dari folder /src/assets/galeri
const semuaGambar = import.meta.glob(
  "/src/assets/galeri/**/*.{png,jpg,jpeg,webp}"
);

const dataGaleri = [];

for (const path in semuaGambar) {
  const modulGambar = await semuaGambar[path]();
  const namaFile = path.split("/").pop();
  const namaArtis = namaFile.split(".").slice(0, -1).join(".");

  // Astro memproses setiap gambar dan memberinya URL unik
  const gambarOptimized = await getImage({
    src: modulGambar.default,
    width: 600,
    format: "webp",
    quality: 80,
  });

  dataGaleri.push({
    artis: `@${namaArtis}`,
    gambar: gambarOptimized,
  });
}
---

<section id="galeri" class="gallery">
  <h3 class="section-title">Karya</h3>

  <div class="gallery-filters">
    {/* ... Tombol filter Anda ... */}
  </div>

  <div class="swiper-container">
    <div class="swiper">
      <div class="swiper-wrapper">
        {
          dataGaleri.map((item) => (
            <div class="swiper-slide">
              <div class="gallery-item">
                <img
                  src={item.gambar.src}
                  width={item.gambar.attributes.width}
                  height={item.gambar.attributes.height}
                  alt={`Poster Design by ${item.artis}`}
                  loading="lazy"
                />
                <div class="gallery-overlay">
                  <h4>Poster</h4>
                  <p>by {item.artis}</p>
                </div>
              </div>
            </div>
          ))
        }
      </div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
      <div class="swiper-pagination"></div>
    </div>
  </div>
</section>

<div id="lightbox" class="lightbox">
  <span class="close-button">&times;</span>
  <img class="lightbox-content" id="lightbox-img" />
</div>

<script>
  import Swiper from "swiper";
  import { Navigation, Pagination, Autoplay } from "swiper/modules";

  document.addEventListener("DOMContentLoaded", function () {
    const swiper = new Swiper(".swiper", {
      modules: [Navigation, Pagination, Autoplay],
      loop: true,
      grabCursor: true,
      slidesPerView: 1,
      spaceBetween: 30,
      breakpoints: {
        640: { slidesPerView: 2 },
        1024: { slidesPerView: 3 },
      },
      autoplay: {
        delay: 3500,
        disableOnInteraction: true,
      },
      pagination: {
        el: ".swiper-pagination",
        clickable: true,
      },
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
    });
  });
</script>
