---
import { getImage } from "astro:assets";

// Perintah ini secara otomatis membaca semua gambar dari folder /src/assets/galeri
const semuaGambar = import.meta.glob(
  "/src/assets/galeri/**/*.{png,jpg,jpeg,webp}"
);

const dataGaleri = [];

for (const path in semuaGambar) {
  const modulGambar = await semuaGambar[path]();
  const namaFile = path.split("/").pop();
  const namaArtis = namaFile.split(".").slice(0, -1).join(".");

  // Astro memproses setiap gambar dan memberinya URL unik
  const gambarOptimized = await getImage({
    src: modulGambar.default,
    width: 600,
    format: "webp",
    quality: 80,
  });

  dataGaleri.push({
    artis: `@${namaArtis}`,
    gambar: gambarOptimized,
  });
}
---

<section id="galeri" class="gallery">
  <h3 class="section-title">Karya</h3>

  <div class="gallery-filters">
    {/* ... Tombol filter Anda ... */}
  </div>

  <div class="gallery-grid">
    {
      dataGaleri.map((item) => (
        <div class="gallery-item">
          <img
            src={item.gambar.src}
            width={item.gambar.attributes.width}
            height={item.gambar.attributes.height}
            alt={`Poster Design by ${item.artis}`}
            loading="lazy"
          />
          <div class="gallery-overlay">
            <h4>Poster</h4>
            <p>by {item.artis}</p>
          </div>
        </div>
      ))
    }
  </div>
</section>
